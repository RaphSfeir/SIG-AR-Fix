<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=CP850" http-equiv="Content-Type" />

  <title>File: pg_hstore.rb [sequel-3.41.0 Documentation]</title>

  <link type="text/css" media="screen" href="../../../rdoc.css" rel="stylesheet" />

  <script src="../../../js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>
</head>

<body class="file file-popup">
  <div id="metadata">
    <dl>
      <dt class="modified-date">Last Modified</dt>
      <dd class="modified-date">2012-11-14 23:59:15 +0100</dd>

      
      <dt class="requires">Requires</dt>
      <dd class="requires">
        <ul>
        
          <li>delegate</li>
        
          <li>strscan</li>
        
        </ul>
      </dd>
      

      
    </dl>
  </div>

  <div id="documentation">
    
    <div class="description">
      <h2>Description</h2>
      
<p>The pg_hstore extension adds support for the PostgreSQL hstore type to <a
href="../../../Sequel.html">Sequel</a>.  hstore is an extension that ships
with PostgreSQL, and the hstore type stores an arbitrary key-value table,
where the keys are strings and the values are strings or NULL.</p>

<p>This extension integrates with Sequel's native postgres adapter, so that
when hstore fields are retrieved, they are parsed and returned as instances
of <a
href="../../../Sequel/Postgres/HStore.html">Sequel::Postgres::HStore</a>. 
HStore is a DelegateClass of <a href="../../../Hash.html">Hash</a>, so it
mostly acts like a hash, but not completely (is_a?(<a
href="../../../Hash.html">Hash</a>) is false).  If you want the actual
hash, you can call Hstore#to_hash.  This is done so that <a
href="../../../Sequel.html">Sequel</a> does not treat a HStore like a <a
href="../../../Hash.html">Hash</a> by default, which would cause issues.</p>

<p>In addition to the parsers, this extension comes with literalizers for
HStore using the standard <a href="../../../Sequel.html">Sequel</a>
literalization callbacks, so they work with on all adapters.</p>

<p>To turn an existing <a href="../../../Hash.html">Hash</a> into an HStore,
use Sequel.hstore:</p>

<pre>Sequel.hstore(hash)</pre>

<p>If you have loaded the <a
href="../../../files/doc/core_extensions_rdoc.html">core_extensions
extension</a>), you can also use <a
href="../../../Hash.html#method-i-hstore">Hash#hstore</a>:</p>

<pre>hash.hstore</pre>

<p>Since the hstore type only supports strings, non string keys and values are
converted to strings</p>

<pre>{:foo=&gt;1}.hstore.to_hash # {'foo'=&gt;'1'}
v = {}.hstore
v[:foo] = 1
v # {'foo'=&gt;'1'}</pre>

<p>However, to make life easier, lookups by key are converted to strings (even
when accessing the underlying hash directly):</p>

<pre>{'foo'=&gt;'bar'}.hstore[:foo] # 'bar'
{'foo'=&gt;'bar'}.hstore.to_hash[:foo] # 'bar'</pre>

<p>HStore instances mostly just delegate to the underlying hash instance, so
<a href="../../../Hash.html">Hash</a> methods that modify the receiver or
returned modified copies of the receiver may not do string conversion. The
following methods will handle string conversion, and more can be added
later if desired:</p>
<ul><li>
<p>[]</p>
</li><li>
<p>[]=</p>
</li><li>
<p>assoc (ruby 1.9 only)</p>
</li><li>
<p>delete</p>
</li><li>
<p>fetch</p>
</li><li>
<p>has_key?</p>
</li><li>
<p>has_value?</p>
</li><li>
<p>include?</p>
</li><li>
<p>key (ruby 1.9 only)</p>
</li><li>
<p>key?</p>
</li><li>
<p>member?</p>
</li><li>
<p>merge</p>
</li><li>
<p>merge!</p>
</li><li>
<p>rassoc (ruby 1.9 only)</p>
</li><li>
<p>replace</p>
</li><li>
<p>store</p>
</li><li>
<p>update</p>
</li><li>
<p>value?</p>
</li></ul>

<p>If you want to insert a hash into an hstore database column:</p>

<pre>DB[:table].insert(:column=&gt;{'foo'=&gt;'bar'}.hstore)</pre>

<p>If you would like to use hstore columns in your model objects, you probably
want to modify the schema parsing/typecasting so that it recognizes and
correctly handles the hstore columns, which you can do by:</p>

<pre>DB.extension :pg_hstore</pre>

<p>If you are not using the native postgres adapter, you probably also want to
use the typecast_on_load plugin in the model, and set it to typecast the
hstore column(s) on load.</p>

<p>This extension requires the delegate and strscan libraries.</p>

    </div>
    
  </div>
</body>
</html>

