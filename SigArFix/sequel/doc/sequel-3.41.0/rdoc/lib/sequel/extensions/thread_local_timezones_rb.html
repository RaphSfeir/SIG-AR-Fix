<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=CP850" http-equiv="Content-Type" />

  <title>File: thread_local_timezones.rb [sequel-3.41.0 Documentation]</title>

  <link type="text/css" media="screen" href="../../../rdoc.css" rel="stylesheet" />

  <script src="../../../js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>
</head>

<body class="file file-popup">
  <div id="metadata">
    <dl>
      <dt class="modified-date">Last Modified</dt>
      <dd class="modified-date">2012-11-14 23:59:15 +0100</dd>

      
      <dt class="requires">Requires</dt>
      <dd class="requires">
        <ul>
        
        </ul>
      </dd>
      

      
    </dl>
  </div>

  <div id="documentation">
    
    <div class="description">
      <h2>Description</h2>
      
<p>The thread_local_timezones extension allows you to set a per-thread
timezone that will override the default global timezone while the thread is
executing.  The main use case is for web applications that execute each
request in its own thread, and want to set the timezones based on the
request.</p>

<p>To load the extension:</p>

<pre>Sequel.extension :thread_local_timezones</pre>

<p>The most common example is having the database always store time in UTC,
but have the application deal with the timezone of the current user.  That
can be done with:</p>

<pre>Sequel.database_timezone = :utc
# In each thread:
Sequel.thread_application_timezone = current_user.timezone</pre>

<p>This extension is designed to work with the named_timezones extension.</p>

<p>This extension adds the thread_application_timezone=,
thread_database_timezone=, and thread_typecast_timezone= methods to the <a
href="../../../Sequel.html">Sequel</a> module.  It overrides the
application_timezone, database_timezone, and typecast_timezone methods to
check the related thread local timezone first, and use it if present. If
the related thread local timezone is not present, it falls back to the
default global timezone.</p>

<p>There is one special case of note.  If you have a default global timezone
and you want to have a nil thread local timezone, you have to set the
thread local value to :nil instead of nil:</p>

<pre>Sequel.application_timezone = :utc
Sequel.thread_application_timezone = nil
Sequel.application_timezone # =&gt; :utc
Sequel.thread_application_timezone = :nil
Sequel.application_timezone # =&gt; nil</pre>

    </div>
    
  </div>
</body>
</html>

