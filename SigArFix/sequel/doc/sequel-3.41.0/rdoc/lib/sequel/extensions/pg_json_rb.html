<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=CP850" http-equiv="Content-Type" />

  <title>File: pg_json.rb [sequel-3.41.0 Documentation]</title>

  <link type="text/css" media="screen" href="../../../rdoc.css" rel="stylesheet" />

  <script src="../../../js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>
</head>

<body class="file file-popup">
  <div id="metadata">
    <dl>
      <dt class="modified-date">Last Modified</dt>
      <dd class="modified-date">2012-11-14 23:59:15 +0100</dd>

      
      <dt class="requires">Requires</dt>
      <dd class="requires">
        <ul>
        
          <li>delegate</li>
        
          <li>json</li>
        
          <li>adapters/utils/pg_types</li>
        
        </ul>
      </dd>
      

      
    </dl>
  </div>

  <div id="documentation">
    
    <div class="description">
      <h2>Description</h2>
      
<p>The pg_json extension adds support for <a
href="../../../Sequel.html">Sequel</a> to handle PostgreSQL's json type. 
It is slightly more strict than the PostgreSQL json type in that the object
returned must be an array or object (PostgreSQL's json type considers plain
numbers and strings as valid).  This is because <a
href="../../../Sequel.html">Sequel</a> relies completely on the ruby JSON
library for parsing, and ruby's JSON library does not accept the values.</p>

<p>This extension integrates with Sequel's native postgres adapter, so that
when json fields are retrieved, they are parsed and returned as instances
of <a
href="../../../Sequel/Postgres/JSONArray.html">Sequel::Postgres::JSONArray</a>
or <a
href="../../../Sequel/Postgres/JSONHash.html">Sequel::Postgres::JSONHash</a>.
JSONArray and JSONHash are DelegateClasses of <a
href="../../../Array.html">Array</a> and <a
href="../../../Hash.html">Hash</a>, so they mostly act the same, but not
completely (json_array.is_a?(<a href="../../../Array.html">Array</a>) is
false).  If you want the actual array for a JSONArray, call JSONArray#to_a.
If you want the actual hash for a JSONHash, call JSONHash#to_hash. This is
done so that <a href="../../../Sequel.html">Sequel</a> does not treat
JSONArray and JSONHash like <a href="../../../Array.html">Array</a> and <a
href="../../../Hash.html">Hash</a> by default, which would cause issues.</p>

<p>To turn an existing <a href="../../../Array.html">Array</a> or <a
href="../../../Hash.html">Hash</a> into a JSONArray or JSONHash, use
Sequel.pg_json:</p>

<pre>Sequel.pg_json(array)
Sequel.pg_json(hash)</pre>

<p>If you have loaded the <a
href="../../../files/doc/core_extensions_rdoc.html">core_extensions
extension</a>), you can also use <a
href="../../../Array.html#method-i-pg_json">Array#pg_json</a> and <a
href="../../../Hash.html#method-i-pg_json">Hash#pg_json</a>:</p>

<pre>array.pg_json
hash.pg_json</pre>

<p>So if you want to insert an array or hash into an json database column:</p>

<pre>DB[:table].insert(:column=&gt;Sequel.pg_json([1, 2, 3]))
DB[:table].insert(:column=&gt;Sequel.pg_json({'a'=&gt;1, 'b'=&gt;2}))</pre>

<p>If you would like to use PostgreSQL json columns in your model objects, you
probably want to modify the schema parsing/typecasting so that it
recognizes and correctly handles the json type, which you can do by:</p>

<pre>DB.extension :pg_json</pre>

<p>If you are not using the native postgres adapter, you probably also want to
use the typecast_on_load plugin in the model, and set it to typecast the
json column(s) on load.</p>

<p>This extension integrates with the pg_array extension.  If you plan to use
the json[] type, load the pg_array extension before the pg_json extension:</p>

<pre>DB.extension :pg_array, :pg_json</pre>

<p>This extension requires both the json and delegate libraries.</p>

    </div>
    
  </div>
</body>
</html>

