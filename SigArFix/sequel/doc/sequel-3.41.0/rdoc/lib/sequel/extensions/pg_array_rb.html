<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=CP850" http-equiv="Content-Type" />

  <title>File: pg_array.rb [sequel-3.41.0 Documentation]</title>

  <link type="text/css" media="screen" href="../../../rdoc.css" rel="stylesheet" />

  <script src="../../../js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>
</head>

<body class="file file-popup">
  <div id="metadata">
    <dl>
      <dt class="modified-date">Last Modified</dt>
      <dd class="modified-date">2012-11-14 23:59:15 +0100</dd>

      
      <dt class="requires">Requires</dt>
      <dd class="requires">
        <ul>
        
          <li>delegate</li>
        
          <li>json</li>
        
          <li>adapters/utils/pg_types</li>
        
        </ul>
      </dd>
      

      
    </dl>
  </div>

  <div id="documentation">
    
    <div class="description">
      <h2>Description</h2>
      
<p>The pg_array extension adds support for <a
href="../../../Sequel.html">Sequel</a> to handle PostgreSQL's array types.</p>

<p>This extension integrates with Sequel's native postgres adapter, so that
when array fields are retrieved, they are parsed and returned as instances
of <a
href="../../../Sequel/Postgres/PGArray.html">Sequel::Postgres::PGArray</a>.
PGArray is a DelegateClass of <a href="../../../Array.html">Array</a>, so
it mostly acts like an array, but not completely (is_a?(<a
href="../../../Array.html">Array</a>) is false).  If you want the actual
array, you can call PGArray#to_a.  This is done so that <a
href="../../../Sequel.html">Sequel</a> does not treat a PGArray like an <a
href="../../../Array.html">Array</a> by default, which would cause issues.</p>

<p>In addition to the parsers, this extension comes with literalizers for
PGArray using the standard <a href="../../../Sequel.html">Sequel</a>
literalization callbacks, so they work with on all adapters.</p>

<p>To turn an existing <a href="../../../Array.html">Array</a> into a PGArray:</p>

<pre>Sequel.pg_array(array)</pre>

<p>If you have loaded the <a
href="../../../files/doc/core_extensions_rdoc.html">core_extensions
extension</a>), you can also use <a
href="../../../Array.html#method-i-pg_array">Array#pg_array</a>:</p>

<pre>array.pg_array</pre>

<p>You can also provide a type, though it many cases it isn't necessary:</p>

<pre>Sequel.pg_array(array, :varchar) # or :integer, :&quot;double precision&quot;, etc.
array.pg_array(:varchar) # or :integer, :&quot;double precision&quot;, etc.</pre>

<p>So if you want to insert an array into an integer[] database column:</p>

<pre>DB[:table].insert(:column=&gt;Sequel.pg_array([1, 2, 3]))</pre>

<p>If you would like to use PostgreSQL arrays in your model objects, you
probably want to modify the schema parsing/typecasting so that it
recognizes and correctly handles the arrays, which you can do by:</p>

<pre>DB.extension :pg_array</pre>

<p>If you are not using the native postgres adapter, you probably also want to
use the typecast_on_load plugin in the model, and set it to typecast the
array column(s) on load.</p>

<p>This extension by default includes handlers for array types for all scalar
types that the native postgres adapter handles. It also makes it easy to
add support for other array types.  In general, you just need to make sure
that the scalar type is handled and has the appropriate converter installed
in Sequel::Postgres::PG_TYPES under the appropriate type OID. Then you can
call <a
href="../../../Sequel/Postgres/PGArray.html#method-c-register">Sequel::Postgres::PGArray.register</a>
with the appropriate arguments to automatically set up a handler for the
array type.</p>

<p>For example, if you add support for a scalar custom type named foo which
uses OID 1234, and you want to add support for the foo[] type, which uses
type OID 4321, you need to do:</p>

<pre>Sequel::Postgres::PGArray.register('foo', :oid=&gt;4321, :scalar_oid=&gt;1234)</pre>

<p><a
href="../../../Sequel/Postgres/PGArray.html#method-c-register">Sequel::Postgres::PGArray.register</a>
has many additional options and should be able to handle most PostgreSQL
array types.</p>

<p>If you want an easy way to call PostgreSQL array functions and operators,
look into the pg_array_ops extension.</p>

<p>This extension requires both the json and delegate libraries.</p>

<h2>Additional License</h2>

<p>PGArray::Parser code was translated from Javascript code in the
node-postgres project and has the following additional license:</p>

<p>Copyright ¸ 2010 Brian Carlson (brian.m.carlson@gmail.com)</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the "Software"),
to deal in the Software without restriction, including without limitation
the rights to use, copy, modify, merge, publish, distribute, sublicense,
and/or sell copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
DEALINGS IN THE SOFTWARE.</p>

    </div>
    
  </div>
</body>
</html>

