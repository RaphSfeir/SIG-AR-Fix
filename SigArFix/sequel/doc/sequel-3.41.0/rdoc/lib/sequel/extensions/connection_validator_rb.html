<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=CP850" http-equiv="Content-Type" />

  <title>File: connection_validator.rb [sequel-3.41.0 Documentation]</title>

  <link type="text/css" media="screen" href="../../../rdoc.css" rel="stylesheet" />

  <script src="../../../js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../../../js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>
</head>

<body class="file file-popup">
  <div id="metadata">
    <dl>
      <dt class="modified-date">Last Modified</dt>
      <dd class="modified-date">2012-11-14 23:59:15 +0100</dd>

      
      <dt class="requires">Requires</dt>
      <dd class="requires">
        <ul>
        
        </ul>
      </dd>
      

      
    </dl>
  </div>

  <div id="documentation">
    
    <div class="description">
      <h2>Description</h2>
      
<p>The connection_validator extension modifies a database's connection pool to
validate that connections checked out from the pool are still valid, before
yielding them for use.  If it detects an invalid connection, it removes it
from the pool and tries the next available connection, creating a new
connection if no available connection is valid.  Example of use:</p>

<pre>DB.extension(:connection_validator)</pre>

<p>As checking connections for validity involves issuing a query, which is
potentially an expensive operation, the validation checks are only run if
the connection has been idle for longer than a certain threshold. By
default, that threshold is 3600 seconds (1 hour), but it can be modified by
the user, set to -1 to always validate connections on checkout:</p>

<pre>DB.pool.connection_validation_timeout = -1</pre>

<p>Note that if you set the timeout to validate connections on every checkout,
you should probably manually control connection checkouts on a coarse
basis, using Database#synchonrize.  In a web application, the optimal place
for that would be a rack middleware.  Validating connections on every
checkout without setting up coarse connection checkouts will hurt
performance, in some cases significantly.  Note that setting up coarse
connection checkouts reduces the concurrency level acheivable.  For
example, in a web application, using Database#synchronize in a rack
middleware will limit the number of concurrent web requests to the number
to connections in the database connection pool.</p>

<p>Note that this extension only affects the default threaded and the sharded
threaded connection pool.  The single threaded and sharded single threaded
connection pools are not affected.  As the only reason to use the single
threaded pools is for speed, and this extension makes the connection pool
slower, there's not much point in modifying this extension to work with the
single threaded pools.  The threaded pools work fine even in single
threaded code, so if you are currently using a single threaded pool and
want to use this extension, switch to using a threaded pool.</p>

    </div>
    
  </div>
</body>
</html>

